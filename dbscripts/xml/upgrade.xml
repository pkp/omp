<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE install SYSTEM "../../lib/pkp/dtd/install.dtd">
<!--
  * dbscripts/xml/upgrade.xml
  *
  * Copyright (c) 2014-2016 Simon Fraser University Library
  * Copyright (c) 2003-2016 John Willinsky
  * Distributed under the GNU GPL v2. For full terms see the file docs/COPYING.
  *
  * Upgrade descriptor file.
  -->

<install version="1.2.0.0">
	<!-- there are some column and table name changes that need to occur first. -->
	<upgrade minversion="0.9.9.0" maxversion="1.0.9.0">
		<!-- Upgrade prior versions to 1.1.0.0 -->
		<code function="syncSeriesAssocType" />
		<data file="dbscripts/xml/upgrade/1.1.0.0_preupdate.xml" condition="return $installer->columnExists('plugin_settings', 'press_id');" />
	</upgrade>

	<upgrade minversion="0.9.9.0" maxversion="1.1.9.0">
		<!-- Upgrade prior versions to 1.2.0.0 -->
		<data file="dbscripts/xml/upgrade/1.2.0.0_preupdate.xml" condition="return $installer->tableExists('series_editors');" />
	</upgrade>

	<!-- PKP schema components -->
	<schema file="lib/pkp/xml/schema/common.xml" />
	<schema file="lib/pkp/xml/schema/scheduledTasks.xml" />
	<schema file="lib/pkp/xml/schema/temporaryFiles.xml" />
	<schema file="lib/pkp/xml/schema/log.xml" />
	<schema file="lib/pkp/xml/schema/notes.xml" />
	<schema file="lib/pkp/xml/schema/controlledVocab.xml" />
	<schema file="lib/pkp/xml/schema/metadata.xml" />
	<schema file="lib/pkp/xml/schema/announcements.xml" />
	<schema file="lib/pkp/xml/schema/signoff.xml" />
	<schema file="lib/pkp/xml/schema/reviews.xml" />
	<schema file="lib/pkp/xml/schema/reviewForms.xml" />
	<schema file="lib/pkp/xml/schema/submissions.xml" />
	<schema file="lib/pkp/xml/schema/submissionFiles.xml" />
	<schema file="lib/pkp/xml/schema/mutex.xml" />
	<schema file="lib/pkp/xml/schema/tombstone.xml" />
	<schema file="lib/pkp/xml/schema/genres.xml" />
	<schema file="lib/pkp/xml/schema/rolesAndUserGroups.xml" />
	<schema file="lib/pkp/xml/schema/views.xml" />
	<schema file="lib/pkp/xml/schema/metrics.xml" />

	<!-- OMP schema -->
	<schema file="dbscripts/xml/omp_schema.xml" />

	<upgrade minversion="0.9.9.0" maxversion="1.0.9.9">
		<!-- Upgrade prior versions to 1.1.0.0 -->
		<data file="dbscripts/xml/upgrade/1.1.0.0_update.xml" />
		<code function="fixFilenames" />
		<code function="enableDefaultTheme" />
	</upgrade>

	<upgrade minversion="0.9.9.0" maxversion="1.0.0.0">
		<!--
		 - Upgrade from 1.0.0.0 (excluding 1.0.1.0, which was
		 - briefly in the omp-stable-1_0 branch).
		 -->
		<data file="dbscripts/xml/upgrade/1.1.0.0_update2.xml" />
	</upgrade>

	<upgrade minversion="0.9.9.0" maxversion="1.1.0.9">
		<code function="fixAuthorSettings" /><!-- Bug #8663 -->
		<data file="dbscripts/xml/upgrade/1.1.1.0_update.xml" />
	</upgrade>

	<upgrade minversion="0.9.9.0" maxversion="1.1.9.9">
		<code function="htmlifyEmailTemplates" /><!-- Bug #8929 -->
		<data file="dbscripts/xml/upgrade/1.2.0.0_update.xml" />
		<code function="convertQueries" />
		<note file="docs/release-notes/README-BEACON" />
	</upgrade>

	<!-- Update plugin configuration - should be done as the final upgrade task -->
	<code function="addPluginVersions" />
</install>
